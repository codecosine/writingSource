(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{346:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("本文为个人学习记录\n没有什么参考价值，源自一篇大牛的文章\nhttps://github.com/dwqs/blog/issues/61")]),t._v(" "),a("h3",{attrs:{id:"promise"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#promise"}},[t._v("#")]),t._v(" Promise")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    Promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("t")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("我的猜测是\n3421\n原因也很直接，promise异步设计的Then本意就是在执行完成回调以后。\n这个执行完成中除了包括后面函数的执行\n而Promise.resolve()这种似乎像是SetTimeout(cb,0)的用法\n就让他先执行吧\n~尴尬的是结果是\n4321")]),t._v(" "),a("p",[t._v("emmmmm...其实我就是什么都没懂\n我们一起来重新预习一遍吧")]),t._v(" "),a("h2",{attrs:{id:"事件循环回顾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件循环回顾"}},[t._v("#")]),t._v(" 事件循环回顾")]),t._v(" "),a("ul",[a("li",[t._v("事件循环EventLoop是通过任务队列TaskQueue的机制来进行协调的")]),t._v(" "),a("li",[t._v("在同一个事件循环中，可以有不止一个任务队列")]),t._v(" "),a("li",[t._v("每个任务都有一个任务源task source ，源自同一个任务源的Task必须放在同一个任务队列")]),t._v(" "),a("li",[t._v("再强调一次，不同的任务源有不同的异步任务队列")]),t._v(" "),a("li",[t._v("在事件循环中，每进行一次循环操作成为Tick")])]),t._v(" "),a("h3",{attrs:{id:"每一次tick中任务的处理模型的关键步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#每一次tick中任务的处理模型的关键步骤"}},[t._v("#")]),t._v(" 每一次Tick中任务的处理模型的关键步骤")]),t._v(" "),a("ul",[a("li",[t._v("在本次Tick中最先进入队列的任务（oldest task）,如果有则执行（我这里理解的是上一次遗留下来的任务，他在tick中最先进入）")]),t._v(" "),a("li",[t._v("检查是否存在MicroTasks，如果存在则不停执行MicroTask，直到清空 Microtasks Queue")]),t._v(" "),a("li",[t._v("microTask是队列，先进先出")]),t._v(" "),a("li",[t._v("更新render")]),t._v(" "),a("li",[t._v("主线程重复执行上面的步骤")])]),t._v(" "),a("h3",{attrs:{id:"task-microtask"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#task-microtask"}},[t._v("#")]),t._v(" task,microtask")]),t._v(" "),a("p",[t._v("在ES2015中 microtask又被称为Job")]),t._v(" "),a("ul",[a("li",[t._v("(macro)task主要包含：script(整体代码)、setTimeout、setInterval、I/O、UI交互事件、setImmediate(Node.js 环境)")]),t._v(" "),a("li",[t._v("microtask主要包含：Promise、MutaionObserver、process.nextTick(Node.js 环境)")])]),t._v(" "),a("blockquote",[a("p",[t._v("在 Node 中，会优先清空 next tick queue，即通过process.nextTick 注册的函数，再清空 other queue，常见的如Promise；此外，timers(setTimeout/setInterval) 会优先于 setImmediate 执行，因为前者在 timer 阶段执行，后者在 check 阶段执行。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);