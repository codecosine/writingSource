# IOC 与 DI
嘛，这个概念不算什么新接触的概念，早些时候接触Java框架Spring的时候就隆重的介绍过这两个著名的概念。
似乎好像对前端应该是比较陌生的？今天突然看到这两个关键词，嘛，查了一些相关的文章，又来吹了。

因为也不是科普，只是自省的文字，就简单的切入正题？

## 控制反转
你觉得控制反转的是什么？这名字就像是，把原本交给别人做的东西，反转回来自己做了。

这里我只举前端的例子。
你因为不想手写ajax请求，使用了一下第三方的$.ajax()发送了一个异步请求，你在内部定义的回调进行了各种操作。
有一天你发现线上出BUG了，经过一顿调查，锁定是这个请求的问题，最后在network中截获了4个这样的请求，明明只发送了一次，却重复发送了4次。
毫无疑问，这是第三方库的锅，他内部实现出现了一个BUG。
你会怎么解决？

## 前端中控制反转产生的信任问题

ajax()的异步操作是在“未来”发生的,你把"未来"交给了第三方库去控制。
因为第三方的问题，你的回调函数调用了多次，产生了BUG。

我们把这称为控制反转。
所以上面的说法应该是，把原本自己控制的东西，权利移交给了别人。
看我硬生生把控制反转解释成了不好的东西！

你足够相信这个反转的对象，当然可以放心的交给他。
除非这个他是你自己写的，否则就永远不在真正的你的控制范围之内。

来说说Promise的设计思路和这个最重要的关联

如果我们不把自己程序的“未来”交给第三方库来实现，而只是要求第三方库来控制反转===>也就是第三方库提供一个接口给我们了解“未来”何时到来的能力
，然后让我们自己来决定下一步做什么，这样控制权就又反转回来到我们自己手上了。
这种范式成为Promise.
嘛,你可能还会想,这也叫反转了？主要的ajax逻辑依然是交给第三方来控制的啊？留个伏笔，我们在讲Promise的时候再说。

## 再来说依赖注入

这个似乎和上面的控制反转密切相关，甚至很多人都认为，这其实是在不同角度叙述同一个事情。
> 依赖注入是手段，控制反转是目的
然而我的印象只有唯一一个：我想要的，只要声明，容器就会给我。angular中大量的使用了DI的概念，进行服务化的接口思路，其本质目的就是为了将服务功能接口独立，让组件注入服务，从而实现组件解耦。
这进一步解释就是：因为我需要这个服务，所以我才要声明告诉容器我想要，而所有我想要的，都应该是实现接口的已注册服务，他能干什么，这是可预期的，容器会给我，这也是可预期的。

没错，这个服务就是ajax()，但是我们并不是处理更多“未来”的事情，而且服务由自己实现，所以信任的问题可以忽略。

欢迎讨论~

- 参考
- 《你不知道的JavaScript 中卷》 回调
- [简单解释什么是 依赖注入 和 控制反转](https://juejin.im/post/5961bd955188250da35f05d7)